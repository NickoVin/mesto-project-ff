(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}var o={baseUrl:"https://nomoreparties.co/v1/cohort-magistr-2",headers:{authorization:"7d94ca1a-3ca0-4ad0-af4f-3aa495c39809","Content-Type":"application/json"}};function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return fetch("".concat(o.baseUrl).concat(t).concat(n),{method:e,headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}var c=document.querySelector("#card-template").content;function u(e,t,n,o,r){var u=c.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__image"),a=u.querySelector(".card__like-button"),s=u.querySelector(".card__like-counter");return u.querySelector(".card__title").textContent=e.name,i.src=e.link,i.alt=e.name,u.querySelector(".card__delete-button").addEventListener("click",t),u.querySelector(".card__like-button").addEventListener("click",n),i.addEventListener("click",(function(){return o(e)})),e.likes.some((function(e){return e._id==r}))&&a.classList.add("card__like-button_is-active"),s.textContent=e.likes.length,u.id=e._id,u}function i(e){var t,n=e.target.closest(".card");console.log(n.id),(t=n.id,r("DELETE","/cards/",t)).then((function(e){"Пост удалён"==e.message&&n.remove()})).catch((function(e){return console.log(e)}))}function a(e){var t,n=e.target,o=n.closest(".card"),c=o.querySelector(".card__like-counter");n.classList.contains("card__like-button_is-active")?(t=o.id,r("DELETE","/cards/likes/",t)).then((function(e){n.classList.remove("card__like-button_is-active"),c.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return r("PUT","/cards/likes/",e)}(o.id).then((function(e){n.classList.add("card__like-button_is-active"),c.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}var s=null;function l(e,t){f(t),Array.from(e.querySelectorAll(s.inputSelector)).forEach((function(t){return _(e,t)})),p(e.querySelector(s.submitButtonSelector))}function d(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e){e.disabled=!1,e.classList.remove(s.inactiveButtonClass)}(t):p(t)}function p(e){e.disabled=!0,e.classList.add(s.inactiveButtonClass)}function _(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(s.inputErrorClass),n.classList.remove(s.errorClass),n.textContent=""}function f(e){e&&!s&&["formSelector","inputSelector","submitButtonSelector","inactiveButtonClass","inputErrorClass","errorClass"].every((function(t){return t in e&&""!=e.key}))&&(s=e)}var m=document.querySelector(".places__list"),y=document.querySelector(".profile__image__edit-button"),v=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_edit-image"),b=document.querySelector(".popup_type_edit"),q=document.querySelector(".popup_type_new-card"),E=document.querySelector(".popup_type_image"),g=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),k=b.querySelector(".popup__input_type_name"),L=b.querySelector(".popup__input_type_description"),x=E.querySelector(".popup__image"),T=E.querySelector(".popup__caption"),j=document.forms["edit-profile"],A=document.forms["new-place"],P=document.forms["edit-image"],B=document.querySelectorAll(".popup"),w=document.querySelector(".profile__image"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function U(t){x.src=t.link,x.alt=t.name,T.textContent=t.name,e(E)}y.addEventListener("click",(function(){P.reset(),e(h),l(j,D)})),v.addEventListener("click",(function(){k.value=g.textContent,L.value=C.textContent,e(b),l(j,D)})),S.addEventListener("click",(function(){A.reset(),e(q),l(A,D)})),B.forEach((function(e){e.addEventListener("mousedown",(function(n){0==n.button&&(n.target.classList.contains("popup_is-opened")||n.target.classList.contains("popup__close"))&&t(e)}))})),P.addEventListener("submit",(function(e){e.preventDefault();var n,r=P.querySelector(".popup__input_type_url").value,c=profileForm.querySelector(".popup__button");c.textContent="Сохранение...",(n=r,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))).then((function(){w.style.backgroundImage="url(".concat(r,")"),t(h)})).catch((function(e){return console.log(e)})).finally((function(){return c.textContent="Сохранить"}))})),j.addEventListener("submit",(function(e){e.preventDefault();var n,r=j.querySelector(".popup__button");g.textContent=k.value,C.textContent=L.value,r.textContent="Сохранение...",(n={name:k.value,about:L.value},fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:n.name,about:n.about})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))).then((function(){return t(b)})).catch((function(e){return console.log(e)})).finally((function(){return r.textContent="Сохранить"}))})),A.addEventListener("submit",(function(e){e.preventDefault();var n=A.querySelector(".popup__button"),r={name:A.querySelector(".popup__input_type_card-name").value,link:A.querySelector(".popup__input_type_url").value};n.textContent="Сохранение...",function(e){return fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}(r).then((function(n){m.prepend(u(n,i,a,U)),e.target.reset(),t(q)})).catch((function(e){return console.log(e)})).finally((function(){return n.textContent="Сохранить"}))})),f(D),Array.from(document.querySelectorAll(s.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){return e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(s.inputSelector)),n=e.querySelector(s.submitButtonSelector);d(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.setCustomValidity(""),t.validity.valid?_(e,t):(t.validity.patternMismatch&&t.setCustomValidity(t.dataset.errorMessage),function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(s.inputErrorClass),o.classList.add(s.errorClass),o.textContent=n}(e,t,t.validationMessage))}(e,o),d(t,n)}))}))}(e)})),Promise.all([r("GET","/users/me"),r("GET","/cards")]).then((function(e){var t=e[0],n=e[1];g.textContent=t.name,C.textContent=t.about,w.style.backgroundImage="url(".concat(t.avatar,")"),n.forEach((function(e){var n=u(e,i,a,U,t._id);e.owner._id!=t._id&&n.querySelector(".card__delete-button").remove(),m.append(n)}))}))})();