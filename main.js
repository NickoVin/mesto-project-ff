(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function o(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}var r,c={baseUrl:"https://nomoreparties.co/v1/cohort-magistr-2",headers:{authorization:"7d94ca1a-3ca0-4ad0-af4f-3aa495c39809","Content-Type":"application/json"}},a=function(e,t){return fetch(e,t).then(o)},u=document.querySelector("#card-template").content;function i(e,t,n,o,r){var c=u.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__like-button"),s=c.querySelector(".card__like-counter");return c.querySelector(".card__title").textContent=e.name,a.src=e.link,a.alt=e.name,c.querySelector(".card__delete-button").addEventListener("click",t),c.querySelector(".card__like-button").addEventListener("click",n),a.addEventListener("click",(function(){return o(e)})),e.likes.some((function(e){return e._id==r}))&&i.classList.add("card__like-button_is-active"),s.textContent=e.likes.length,e.owner._id!=r&&card.querySelector(".card__delete-button").remove(),c.id=e._id,c}function s(e){var t,n=e.target.closest(".card");console.log(n.id),(t=n.id,a("".concat(c.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:c.headers})).then((function(e){"Пост удалён"==e.message&&n.remove()})).catch((function(e){return console.log(e)}))}function l(e){var t,n=e.target,o=n.closest(".card"),r=o.querySelector(".card__like-counter");n.classList.contains("card__like-button_is-active")?(t=o.id,a("".concat(c.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:c.headers})).then((function(e){n.classList.remove("card__like-button_is-active"),r.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return a("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers})}(o.id).then((function(e){n.classList.add("card__like-button_is-active"),r.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}function d(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){return m(e,n,t)})),_(e.querySelector(t.submitButtonSelector),t)}function p(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}(t,n):_(t,n)}function _(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function m(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}var f=document.querySelectorAll(".popup"),y=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_edit-image"),b=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),q=document.querySelector(".profile__image__edit-button"),g=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),L=document.querySelector(".profile__image"),x=document.forms["edit-profile"],U=x.querySelector(".popup__input_type_name"),A=x.querySelector(".popup__input_type_description"),T=document.forms["edit-image"],w=T.querySelector(".popup__input_type_url"),B=S.querySelector(".popup__image"),D=S.querySelector(".popup__caption"),P=document.forms["new-place"],N=P.querySelector(".popup__input_type_card-name"),O=P.querySelector(".popup__input_type_url"),j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function J(t){B.src=t.link,B.alt=t.name,D.textContent=t.name,e(S)}q.addEventListener("click",(function(){T.reset(),e(h),d(x,j)})),g.addEventListener("click",(function(){U.value=E.textContent,A.value=k.textContent,e(v),d(x,j)})),C.addEventListener("click",(function(){P.reset(),e(b),d(P,j)})),f.forEach((function(e){e.addEventListener("mousedown",(function(n){0==n.button&&(n.target.classList.contains("popup_is-opened")||n.target.classList.contains("popup__close"))&&t(e)}))})),T.addEventListener("submit",(function(e){var n;e.preventDefault(),e.submitter.textContent="Сохранение...",(n=w.value,a("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:n})})).then((function(){L.style.backgroundImage="url(".concat(w.value,")"),t(h)})).catch((function(e){return console.log(e)})).finally((function(){return e.submitter.textContent="Сохранить"}))})),x.addEventListener("submit",(function(e){var n;e.preventDefault(),e.submitter.textContent="Сохранение...",(n={name:U.value,about:A.value},a("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:n.name,about:n.about})})).then((function(){E.textContent=U.value,k.textContent=A.value,t(v)})).catch((function(e){return console.log(e)})).finally((function(){return e.submitter.textContent="Сохранить"}))})),P.addEventListener("submit",(function(e){var n;e.preventDefault(),e.submitter.textContent="Сохранение...",(n={name:N.value,link:O.value},a("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:n.name,link:n.link})})).then((function(n){y.prepend(i(n,s,l,J,r)),e.target.reset(),t(b)})).catch((function(e){return console.log(e)})).finally((function(){return e.submitter.textContent="Сохранить"}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);p(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.setCustomValidity(""),t.validity.valid?m(e,t,n):(t.validity.patternMismatch&&t.setCustomValidity(t.dataset.errorMessage),function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n))}(e,r,t),p(n,o,t)}))}))}(t,e)}))}(j),Promise.all([a("".concat(c.baseUrl,"/users/me"),{method:"GET",headers:c.headers}),a("".concat(c.baseUrl,"/cards"),{method:"GET",headers:c.headers})]).then((function(e){var t=e[0],n=e[1];r=t._id,E.textContent=t.name,k.textContent=t.about,L.style.backgroundImage="url(".concat(t.avatar,")"),n.forEach((function(e){y.append(i(e,s,l,J,r))}))})).catch((function(e){return console.log(e)}))})();